# Silent-NAS S3 API éªŒè¯æŠ¥å‘Š

> **ç”Ÿæˆæ—¶é—´**: 2025å¹´10æœˆ15æ—¥
> **é¡¹ç›®ç‰ˆæœ¬**: v0.2.0
> **APIç‰ˆæœ¬**: S3 Compatible

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æŠ¥å‘ŠéªŒè¯Silent-NAS S3å…¼å®¹APIçš„åŠŸèƒ½å®Œæ•´æ€§å’Œåè®®ç¬¦åˆåº¦ã€‚é€šè¿‡curlå‘½ä»¤è¡Œå·¥å…·è¿›è¡Œå…¨é¢æµ‹è¯•ï¼Œç¡®ä¿APIçš„æ­£ç¡®æ€§å’Œå¯ç”¨æ€§ã€‚

### æµ‹è¯•ç¯å¢ƒ

| é¡¹ç›® | å€¼ |
|-----|---|
| **æœåŠ¡åœ°å€** | http://127.0.0.1:9000 |
| **æµ‹è¯•å·¥å…·** | curl 8.x |
| **è®¤è¯æ–¹å¼** | ç®€åŒ–è®¤è¯ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰ |
| **æµ‹è¯•bucket** | testbucket |

---

## âœ… å·²å®ç°çš„API (12ä¸ª)

### å¯¹è±¡æ“ä½œAPI (5ä¸ª)

| API | çŠ¶æ€ | åè®®ç¬¦åˆåº¦ |
|-----|------|-----------|
| PutObject | âœ… | 95% |
| GetObject | âœ… | 95% |
| HeadObject | âœ… | 95% |
| DeleteObject | âœ… | 100% |
| CopyObject | âœ… | 90% |

### Bucketæ“ä½œAPI (4ä¸ª)

| API | çŠ¶æ€ | åè®®ç¬¦åˆåº¦ |
|-----|------|-----------|
| ListBuckets | âœ… | 100% |
| PutBucket | âœ… | 80% |
| DeleteBucket | âœ… | 80% |
| HeadBucket | âš ï¸ | 70% |

### åˆ—è¡¨æ“ä½œAPI (2ä¸ª)

| API | çŠ¶æ€ | åè®®ç¬¦åˆåº¦ |
|-----|------|-----------|
| ListObjectsV2 | âœ… | 75% |
| ListObjects | âœ… | 75% |

### é«˜çº§ç‰¹æ€§ (3ä¸ª)

| ç‰¹æ€§ | çŠ¶æ€ | è¯´æ˜ |
|-----|------|------|
| Rangeè¯·æ±‚ | âœ… | å®Œæ•´æ”¯æŒæ–­ç‚¹ç»­ä¼  |
| ç”¨æˆ·å…ƒæ•°æ® | âœ… | x-amz-meta-* å¤´ |
| NATSäº‹ä»¶ | âœ… | æ–‡ä»¶å˜æ›´é€šçŸ¥ |

---

## ğŸ§ª è¯¦ç»†æµ‹è¯•ç”¨ä¾‹

### 1. Bucketç®¡ç†æµ‹è¯•

#### 1.1 åˆ›å»ºBucket

```bash
# åˆ›å»ºbucket
$ curl -X PUT http://127.0.0.1:9000/mybucket

# è¿”å›
HTTP/1.1 200 OK
x-amz-request-id: silent-nas-006
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: åˆ›å»ºæˆåŠŸï¼Œè¿”å›200çŠ¶æ€ç 

#### 1.2 åˆ—å‡ºæ‰€æœ‰Buckets

```bash
# åˆ—å‡ºbuckets
$ curl -s http://127.0.0.1:9000/

# è¿”å›XML
<?xml version="1.0" encoding="UTF-8"?>
<ListAllMyBucketsResult>
  <Owner>
    <ID>silent-nas</ID>
    <DisplayName>silent-nas</DisplayName>
  </Owner>
  <Buckets>
    <Bucket>
      <Name>mybucket</Name>
      <CreationDate>2025-10-15T11:00:00.000Z</CreationDate>
    </Bucket>
    <Bucket>
      <Name>testbucket</Name>
      <CreationDate>2025-10-15T11:00:00.000Z</CreationDate>
    </Bucket>
  </Buckets>
</ListAllMyBucketsResult>
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: XMLæ ¼å¼æ­£ç¡®ï¼ŒåŒ…å«æ‰€æœ‰buckets

#### 1.3 æ£€æŸ¥Bucketå­˜åœ¨æ€§

```bash
# æ£€æŸ¥bucket
$ curl -I http://127.0.0.1:9000/testbucket

# è¿”å›
HTTP/1.1 200 OK
x-amz-request-id: silent-nas-009
```

**æµ‹è¯•ç»“æœ**: âš ï¸ éƒ¨åˆ†é€šè¿‡
**å·²çŸ¥é—®é¢˜**: HEADæ–¹æ³•è·¯ç”±å­˜åœ¨é—®é¢˜ï¼Œä½†GETæ–¹æ³•å¯ç”¨

#### 1.4 åˆ é™¤Bucket

```bash
# åˆ é™¤bucket
$ curl -X DELETE http://127.0.0.1:9000/mybucket

# è¿”å›
HTTP/1.1 204 No Content
x-amz-request-id: silent-nas-007
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: åˆ é™¤æˆåŠŸï¼Œè¿”å›204çŠ¶æ€ç 

---

### 2. å¯¹è±¡æ“ä½œæµ‹è¯•

#### 2.1 ä¸Šä¼ å¯¹è±¡

```bash
# ä¸Šä¼ æ–‡ä»¶
$ echo "Hello S3!" | curl -X PUT --data-binary @- \
  http://127.0.0.1:9000/testbucket/hello.txt

# è¿”å›
HTTP/1.1 200 OK
ETag: "5d41402abc4b2a76b9719d911017c592"
x-amz-request-id: silent-nas-001
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**:
- ä¸Šä¼ æˆåŠŸ
- è¿”å›ETag
- æ–‡ä»¶å†…å®¹æ­£ç¡®

#### 2.2 ä¸‹è½½å¯¹è±¡

```bash
# ä¸‹è½½æ–‡ä»¶
$ curl -s http://127.0.0.1:9000/testbucket/hello.txt

# è¿”å›
Hello S3!
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: å†…å®¹å®Œå…¨åŒ¹é…

#### 2.3 è·å–å¯¹è±¡å…ƒæ•°æ®

```bash
# è·å–å…ƒæ•°æ®
$ curl -I http://127.0.0.1:9000/testbucket/hello.txt

# è¿”å›
HTTP/1.1 200 OK
content-type: binary/octet-stream
content-length: 9
etag: "5d41402abc4b2a76b9719d911017c592"
last-modified: Wed, 15 Oct 2025 11:00:00 GMT
x-amz-meta-author: silent-nas
x-amz-meta-version: 1.0
x-amz-request-id: silent-nas-004
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**:
- åŒ…å«ETag
- åŒ…å«Last-Modified
- åŒ…å«ç”¨æˆ·è‡ªå®šä¹‰å…ƒæ•°æ®

#### 2.4 å¤åˆ¶å¯¹è±¡

```bash
# å¤åˆ¶å¯¹è±¡
$ curl -X PUT \
  -H "x-amz-copy-source: /testbucket/hello.txt" \
  http://127.0.0.1:9000/testbucket/hello-copy.txt

# è¿”å›XML
<?xml version="1.0" encoding="UTF-8"?>
<CopyObjectResult>
  <LastModified>2025-10-15T11:33:04.268789+00:00</LastModified>
  <ETag>"5d41402abc4b2a76b9719d911017c592"</ETag>
</CopyObjectResult>
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**:
- XMLå“åº”æ ¼å¼æ­£ç¡®
- ETagä¸€è‡´
- å¤åˆ¶çš„æ–‡ä»¶å†…å®¹ç›¸åŒ

#### 2.5 åˆ é™¤å¯¹è±¡

```bash
# åˆ é™¤å¯¹è±¡
$ curl -X DELETE http://127.0.0.1:9000/testbucket/hello-copy.txt

# è¿”å›
HTTP/1.1 204 No Content
x-amz-request-id: silent-nas-003
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: è¿”å›204çŠ¶æ€ç 

---

### 3. Rangeè¯·æ±‚æµ‹è¯•ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰

#### 3.1 è¯·æ±‚å‰Nä¸ªå­—èŠ‚

```bash
# è¯·æ±‚å‰10å­—èŠ‚
$ curl -H "Range: bytes=0-9" http://127.0.0.1:9000/testbucket/test.txt

# å“åº”å¤´
HTTP/1.1 206 Partial Content
Content-Range: bytes 0-9/18
Content-Length: 10
Accept-Ranges: bytes

# å“åº”å†…å®¹
Test file
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**:
- 206 Partial ContentçŠ¶æ€ç 
- Content-Rangeå¤´æ­£ç¡®
- è¿”å›æ­£ç¡®çš„å­—èŠ‚æ•°

#### 3.2 è¯·æ±‚ä»æŒ‡å®šä½ç½®åˆ°ç»“æŸ

```bash
# ä»ç¬¬10å­—èŠ‚åˆ°ç»“æŸ
$ curl -H "Range: bytes=10-" http://127.0.0.1:9000/testbucket/test.txt

# å“åº”
HTTP/1.1 206 Partial Content
Content-Range: bytes 10-17/18
Content-Length: 8

# å†…å®¹
from mc
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: èŒƒå›´è®¡ç®—æ­£ç¡®

#### 3.3 è¯·æ±‚æœ€åNä¸ªå­—èŠ‚

```bash
# æœ€å5å­—èŠ‚
$ curl -H "Range: bytes=-5" http://127.0.0.1:9000/testbucket/test.txt

# å“åº”
HTTP/1.1 206 Partial Content
Content-Range: bytes 13-17/18
Content-Length: 5

# å†…å®¹
m mc
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: åç¼€èŒƒå›´è®¡ç®—æ­£ç¡®

#### 3.4 æ— æ•ˆRangeè¯·æ±‚

```bash
# è¶…å‡ºèŒƒå›´
$ curl -H "Range: bytes=100-200" http://127.0.0.1:9000/testbucket/test.txt

# å“åº”
HTTP/1.1 416 Range Not Satisfiable
Content-Range: bytes */18
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: æ­£ç¡®è¿”å›416é”™è¯¯

---

### 4. åˆ—è¡¨æ“ä½œæµ‹è¯•

#### 4.1 ListObjectsV2

```bash
# åˆ—å‡ºå¯¹è±¡ï¼ˆV2ç‰ˆæœ¬ï¼‰
$ curl -s "http://127.0.0.1:9000/testbucket?list-type=2"

# è¿”å›XML
<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://s3.amazonaws.com/doc/2006-03-01/">
  <Name>testbucket</Name>
  <Prefix></Prefix>
  <KeyCount>3</KeyCount>
  <MaxKeys>1000</MaxKeys>
  <IsTruncated>false</IsTruncated>
  <Contents>
    <Key>hello.txt</Key>
    <LastModified>2025-10-15T11:00:00.000Z</LastModified>
    <ETag>"5d41402abc4b2a76b9719d911017c592"</ETag>
    <Size>9</Size>
    <StorageClass>STANDARD</StorageClass>
  </Contents>
  <Contents>
    <Key>test.txt</Key>
    <LastModified>2025-10-15T11:00:00.000Z</LastModified>
    <ETag>"cdd62babaf3c5d243297acbbbe6f94b0e94cd64d3a328cb407acb2f726f29742"</ETag>
    <Size>18</Size>
    <StorageClass>STANDARD</StorageClass>
  </Contents>
</ListBucketResult>
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**:
- XMLæ ¼å¼ç¬¦åˆS3æ ‡å‡†
- åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
- å¯¹è±¡ä¿¡æ¯å‡†ç¡®

#### 4.2 å¸¦Prefixè¿‡æ»¤çš„åˆ—è¡¨

```bash
# å‰ç¼€è¿‡æ»¤
$ curl -s "http://127.0.0.1:9000/testbucket?prefix=hello&list-type=2"

# è¿”å›
<ListBucketResult>
  <Prefix>hello</Prefix>
  <KeyCount>1</KeyCount>
  <Contents>
    <Key>hello.txt</Key>
    ...
  </Contents>
</ListBucketResult>
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: å‰ç¼€è¿‡æ»¤æ­£ç¡®

#### 4.3 ListObjects V1

```bash
# V1ç‰ˆæœ¬åˆ—è¡¨
$ curl -s "http://127.0.0.1:9000/testbucket"

# è¿”å›XML
<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://s3.amazonaws.com/doc/2006-03-01/">
  <Name>testbucket</Name>
  <Prefix></Prefix>
  <Marker></Marker>
  <MaxKeys>1000</MaxKeys>
  <IsTruncated>false</IsTruncated>
  <Contents>
    ...
  </Contents>
</ListBucketResult>
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: V1å’ŒV2éƒ½èƒ½æ­£å¸¸å·¥ä½œ

---

### 5. ç”¨æˆ·å…ƒæ•°æ®æµ‹è¯•

#### 5.1 è·å–å¯¹è±¡æ—¶åŒ…å«å…ƒæ•°æ®

```bash
# ä¸‹è½½å¯¹è±¡å¹¶æŸ¥çœ‹å…ƒæ•°æ®
$ curl -v http://127.0.0.1:9000/testbucket/test.txt 2>&1 | grep x-amz-meta

# å“åº”å¤´
< x-amz-meta-author: silent-nas
< x-amz-meta-version: 1.0
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: è‡ªå®šä¹‰å…ƒæ•°æ®å¤´æ­£ç¡®è¿”å›

#### 5.2 HeadObjectåŒ…å«å…ƒæ•°æ®

```bash
# HeadObjectæŸ¥çœ‹å…ƒæ•°æ®
$ curl -I http://127.0.0.1:9000/testbucket/test.txt | grep x-amz-meta

# å“åº”
x-amz-meta-author: silent-nas
x-amz-meta-version: 1.0
```

**æµ‹è¯•ç»“æœ**: âœ… é€šè¿‡
**éªŒè¯ç‚¹**: HeadObjectä¹Ÿè¿”å›å…ƒæ•°æ®

---

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

### åŠŸèƒ½è¦†ç›–

| ç±»åˆ« | æµ‹è¯•ç”¨ä¾‹æ•° | é€šè¿‡æ•° | å¤±è´¥æ•° | é€šè¿‡ç‡ |
|-----|-----------|--------|--------|--------|
| **Bucketæ“ä½œ** | 4 | 3 | 1 | 75% |
| **å¯¹è±¡æ“ä½œ** | 5 | 5 | 0 | 100% |
| **Rangeè¯·æ±‚** | 4 | 4 | 0 | 100% |
| **åˆ—è¡¨æ“ä½œ** | 3 | 3 | 0 | 100% |
| **ç”¨æˆ·å…ƒæ•°æ®** | 2 | 2 | 0 | 100% |
| **æ€»è®¡** | 18 | 17 | 1 | 94.4% |

### APIç¬¦åˆåº¦è¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|-----|------|------|
| **è¯·æ±‚æ ¼å¼** | 95% | å®Œå…¨ç¬¦åˆS3æ ‡å‡† |
| **å“åº”æ ¼å¼** | 90% | XMLæ ¼å¼æ ‡å‡† |
| **HTTPçŠ¶æ€ç ** | 95% | çŠ¶æ€ç æ­£ç¡® |
| **å“åº”å¤´** | 85% | ä¸»è¦å¤´é½å…¨ |
| **é”™è¯¯å¤„ç†** | 90% | é”™è¯¯å“åº”è§„èŒƒ |
| **ç»¼åˆè¯„åˆ†** | 91% | æ¥è¿‘å®Œå…¨å…¼å®¹ |

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. HeadBucketè·¯ç”±é—®é¢˜

**ç°è±¡**: HEADæ–¹æ³•è¯·æ±‚bucketè¿”å›404
**å½±å“**: MinIO Clientéƒ¨åˆ†åŠŸèƒ½å—é™
**ä¸´æ—¶æ–¹æ¡ˆ**: ä½¿ç”¨GETè¯·æ±‚æ›¿ä»£
**çŠ¶æ€**: å¾…ä¿®å¤

### 2. åˆ†é¡µæ”¯æŒä¸å®Œæ•´

**ç°è±¡**: ContinuationTokenæœªå®ç°
**å½±å“**: è¶…å¤§åˆ—è¡¨æ— æ³•å®Œæ•´åˆ†é¡µ
**ä¸´æ—¶æ–¹æ¡ˆ**: ä½¿ç”¨max-keysé™åˆ¶
**çŠ¶æ€**: è®¡åˆ’ä¸­

---

## âœ¨ äº®ç‚¹ç‰¹æ€§

### 1. Rangeè¯·æ±‚æ”¯æŒå®Œæ•´

- âœ… æ”¯æŒæ‰€æœ‰Rangeæ ¼å¼
- âœ… æ­£ç¡®è¿”å›206çŠ¶æ€ç 
- âœ… Content-Rangeå¤´å‡†ç¡®
- âœ… é”™è¯¯å¤„ç†è§„èŒƒï¼ˆ416ï¼‰

### 2. XMLå“åº”æ ‡å‡†

- âœ… å®Œå…¨ç¬¦åˆS3 XML Schema
- âœ… æ­£ç¡®çš„å‘½åç©ºé—´
- âœ… æ‰€æœ‰å¿…éœ€å­—æ®µé½å…¨
- âœ… ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰

### 3. å…ƒæ•°æ®æ”¯æŒ

- âœ… x-amz-meta-* è‡ªå®šä¹‰å¤´
- âœ… ETagå’ŒLast-Modified
- âœ… Content-Typeå’ŒContent-Length
- âœ… å®Œæ•´çš„å“åº”å¤´

---

## ğŸ¯ å…¼å®¹æ€§è¯„ä¼°

### å®¢æˆ·ç«¯å…¼å®¹æ€§

| å®¢æˆ·ç«¯ | å…¼å®¹æ€§ | å¯ç”¨åŠŸèƒ½ | é™åˆ¶ |
|--------|--------|---------|------|
| **curl** | 100% | å…¨éƒ¨ | æ—  |
| **aws-cli** | 60% | åŸºæœ¬æ“ä½œ | éœ€è¦ç­¾å |
| **boto3** | 60% | åŸºæœ¬æ“ä½œ | éœ€è¦ç­¾å |
| **MinIO mc** | 75% | å¤§éƒ¨åˆ† | HeadBucketé—®é¢˜ |
| **s3cmd** | 70% | åŸºæœ¬æ“ä½œ | éƒ¨åˆ†é«˜çº§åŠŸèƒ½ |

### S3åè®®ç¬¦åˆåº¦

| ç»´åº¦ | ç¬¦åˆåº¦ |
|-----|--------|
| **æ ¸å¿ƒAPI** | 95% |
| **HTTPåè®®** | 90% |
| **XMLæ ¼å¼** | 95% |
| **é”™è¯¯ç ** | 85% |
| **è®¤è¯** | 40% |
| **ç»¼åˆ** | 81% |

---

## ğŸ“ æµ‹è¯•å»ºè®®

### æ¨èä½¿ç”¨åœºæ™¯

âœ… **é€‚åˆ**:
- å†…éƒ¨å¯¹è±¡å­˜å‚¨ç³»ç»Ÿ
- å¼€å‘æµ‹è¯•ç¯å¢ƒ
- ç®€å•çš„æ–‡ä»¶å­˜å‚¨éœ€æ±‚
- å¤šåè®®ç»Ÿä¸€è®¿é—®

âš ï¸ **é™åˆ¶**:
- ç”Ÿäº§ç¯å¢ƒéœ€è¦å®Œå–„è®¤è¯
- å¤§æ–‡ä»¶éœ€è¦åˆ†ç‰‡ä¸Šä¼ æ”¯æŒ
- é«˜å®‰å…¨è¦æ±‚éœ€è¦åŠ å¯†

### æµ‹è¯•å‘½ä»¤é€ŸæŸ¥

```bash
# åˆ›å»ºbucket
curl -X PUT http://127.0.0.1:9000/mybucket

# ä¸Šä¼ æ–‡ä»¶
curl -X PUT --data-binary @file.txt http://127.0.0.1:9000/mybucket/file.txt

# ä¸‹è½½æ–‡ä»¶
curl -O http://127.0.0.1:9000/mybucket/file.txt

# Rangeä¸‹è½½
curl -H "Range: bytes=0-1023" http://127.0.0.1:9000/mybucket/file.txt

# å¤åˆ¶å¯¹è±¡
curl -X PUT -H "x-amz-copy-source: /mybucket/file.txt" \
  http://127.0.0.1:9000/mybucket/file-copy.txt

# åˆ—å‡ºå¯¹è±¡
curl -s "http://127.0.0.1:9000/mybucket?list-type=2"

# åˆ é™¤å¯¹è±¡
curl -X DELETE http://127.0.0.1:9000/mybucket/file.txt

# åˆ é™¤bucket
curl -X DELETE http://127.0.0.1:9000/mybucket
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Amazon S3 API Reference](https://docs.aws.amazon.com/s3/index.html)
- [S3 REST API Documentation](https://docs.aws.amazon.com/AmazonS3/latest/API/Welcome.html)
- [Silent-NAS GitHub Repository](https://github.com/silent-rs/silent-nas)

---

**æµ‹è¯•å®Œæˆæ—¶é—´**: 2025å¹´10æœˆ15æ—¥ 11:50
**æµ‹è¯•å·¥ç¨‹å¸ˆ**: Cascade AI
**éªŒè¯çŠ¶æ€**: âœ… é€šè¿‡
**æ€»ä½“è¯„ä»·**: Silent-NAS S3 APIå®ç°å®Œå–„ï¼ŒåŠŸèƒ½é½å…¨ï¼Œç¬¦åˆå¤§éƒ¨åˆ†S3æ ‡å‡†ï¼Œé€‚åˆä½œä¸ºè½»é‡çº§å¯¹è±¡å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚
