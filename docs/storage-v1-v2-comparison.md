# Storage V1 ä¸ V2 å®Œæ•´åº¦å¯¹æ¯”åˆ†æ

> åˆ†ææ—¥æœŸï¼š2025å¹´11æœˆ13æ—¥
> å½“å‰åˆ†æ”¯ï¼šfeature/v0.7.0-performance-storage
> æœ€åæ›´æ–°ï¼š2025å¹´11æœˆ13æ—¥ - V2 åŸºç¡€åŠŸèƒ½å®Œå–„

## ğŸ“Š æ€»ä½“æ¶æ„å¯¹æ¯”

| ç»´åº¦ | Storage V1 | Storage V2 |
|------|-----------|-----------|
| **æ¶æ„å¤æ‚åº¦** | ç®€å•ã€å•å±‚æ¶æ„ | å¤æ‚ã€å¤šå±‚æ¬¡æ¶æ„ |
| **ä»£ç è¡Œæ•°** | ~527 è¡Œ | ~3500+ è¡Œ |
| **æ¨¡å—åˆ’åˆ†** | å•ä¸€å­˜å‚¨æ¨¡å— | æ ¸å¿ƒå¼•æ“ + æœåŠ¡å±‚ |
| **çŠ¶æ€** | âœ… ç”Ÿäº§å°±ç»ª | âœ… åŸºç¡€åŠŸèƒ½å®Œæˆ |
| **ä¾èµ–** | åŸºç¡€ä¾èµ– | å¤æ‚ä¾èµ–ï¼ˆmokaã€LZ4ã€Zstdç­‰ï¼‰ |

---

## âœ… Storage V1 - å®Œæ•´å®ç°çš„åŠŸèƒ½

### 1. æ ¸å¿ƒå­˜å‚¨åŠŸèƒ½ (100% å®Œæˆ)

- âœ… **æ–‡ä»¶ä¿å­˜** (`save_file`, `save_at_path`)
  - æ”¯æŒæŒ‰æ–‡ä»¶IDä¿å­˜
  - æ”¯æŒæŒ‰ç›¸å¯¹è·¯å¾„ä¿å­˜ï¼ˆWebDAV/S3è¯­ä¹‰ï¼‰
  - è‡ªåŠ¨åˆ›å»ºçˆ¶ç›®å½•

- âœ… **æ–‡ä»¶è¯»å–** (`read_file`)
  - æ”¯æŒå½“å‰å¸ƒå±€
  - å…¼å®¹æ—§å¸ƒå±€ï¼ˆå¤šç§è·¯å¾„æ ¼å¼ï¼‰

- âœ… **æ–‡ä»¶åˆ é™¤** (`delete_file`)
  - å®Œæ•´çš„åˆ é™¤åŠŸèƒ½
  - å…¼å®¹æ—§å¸ƒå±€

- âœ… **æ–‡ä»¶å…ƒæ•°æ®** (`get_metadata`)
  - å®Œæ•´çš„å…ƒæ•°æ®ä¿¡æ¯
  - è‡ªåŠ¨è®¡ç®—SHA-256å“ˆå¸Œ

- âœ… **æ–‡ä»¶åˆ—è¡¨** (`list_files`)
  - é€’å½’æ‰«æç›®å½•
  - è¿”å›å®Œæ•´å…ƒæ•°æ®åˆ—è¡¨

- âœ… **æ–‡ä»¶å­˜åœ¨æ£€æŸ¥** (`file_exists`)

- âœ… **å“ˆå¸ŒéªŒè¯** (`verify_hash`, `calculate_hash`)
  - SHA-256ç®—æ³•
  - å®Œæ•´æ€§æ ¡éªŒ

### 2. S3 å…¼å®¹åŠŸèƒ½ (100% å®Œæˆ)

- âœ… **Bucket ç®¡ç†**
  - `create_bucket` - åˆ›å»ºbucketç›®å½•
  - `delete_bucket` - åˆ é™¤ç©ºbucket
  - `bucket_exists` - æ£€æŸ¥bucketå­˜åœ¨æ€§
  - `list_buckets` - åˆ—å‡ºæ‰€æœ‰buckets

- âœ… **å¯¹è±¡ç®¡ç†**
  - `list_bucket_objects` - åˆ—å‡ºbucketä¸­çš„å¯¹è±¡
  - æ”¯æŒå‰ç¼€è¿‡æ»¤
  - é€’å½’ç›®å½•æ‰«æ

### 3. Trait å®ç° (100% å®Œæˆ)

```rust
// å®ç°äº†å®Œæ•´çš„ trait
impl silent_nas_core::StorageManager for StorageManager
impl silent_nas_core::S3CompatibleStorageTrait for StorageManager
```

### 4. å…¶ä»–ç‰¹æ€§

- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç† (`StorageError`)
- âœ… å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–
- âœ… è·¯å¾„å…¼å®¹æ€§ï¼ˆæ”¯æŒå¤šç§æ—§å¸ƒå±€ï¼‰
- âœ… WebDAV/S3 è·¯å¾„è¯­ä¹‰æ”¯æŒ
- âœ… å¼‚æ­¥I/Oæ“ä½œ
- âœ… æ—¥å¿—è¿½è¸ª

---

## ğŸ”§ Storage V2 - åŠŸèƒ½å®ç°çŠ¶æ€

### æ¶æ„è®¾è®¡

```
silent-storage-v2/
â”œâ”€â”€ core/           # æ ¸å¿ƒå­˜å‚¨å¼•æ“ï¼ˆæ— çŠ¶æ€ï¼‰
â”‚   â”œâ”€â”€ chunker     # åˆ†å—ç®—æ³• (Rabin-Karp)
â”‚   â”œâ”€â”€ compression # å‹ç¼©ç®—æ³• (LZ4/Zstd)
â”‚   â”œâ”€â”€ delta       # å·®å¼‚è®¡ç®—
â”‚   â””â”€â”€ engine      # å¼•æ“ç»„åˆ
â”œâ”€â”€ services/       # æœ‰çŠ¶æ€æœåŠ¡
â”‚   â”œâ”€â”€ dedup       # å»é‡æœåŠ¡
â”‚   â”œâ”€â”€ index       # ç´¢å¼•æœåŠ¡
â”‚   â”œâ”€â”€ tiering     # åˆ†å±‚å­˜å‚¨
â”‚   â””â”€â”€ lifecycle   # ç”Ÿå‘½å‘¨æœŸ
â”œâ”€â”€ storage.rs      # å¢é‡å­˜å‚¨ç®¡ç†
â””â”€â”€ adapter.rs      # Trait é€‚é…å±‚
```

### 1. æ ¸å¿ƒå¼•æ“ (70% å®Œæˆ)

#### âœ… å·²å®Œæˆæ¨¡å—

**1.1 æ»šåŠ¨å“ˆå¸Œåˆ†å—** (`chunker.rs`)
- âœ… Rabin-Karp ç®—æ³•å®ç°
- âœ… å†…å®¹å®šä¹‰åˆ†å— (CDC)
- âœ… å¼±å“ˆå¸Œ + å¼ºå“ˆå¸ŒåŒæ ¡éªŒ
- âœ… å¯é…ç½®çš„å—å¤§å°èŒƒå›´
- âœ… è¾¹ç•Œæ£€æµ‹é€»è¾‘

**1.2 å‹ç¼©ç®—æ³•** (`compression.rs`)
- âœ… LZ4 å¿«é€Ÿå‹ç¼©
- âœ… Zstd é«˜å‹ç¼©æ¯”
- âœ… å‹ç¼©æ¯”ç›‘æ§
- âœ… æœ€å°æ•°æ®å¤§å°é˜ˆå€¼
- âœ… å‹ç¼©ç»“æœç»Ÿè®¡

**1.3 å·®å¼‚è®¡ç®—** (`delta.rs`)
- âœ… Delta ç”Ÿæˆç®—æ³•
- âœ… åŸºäºå—çš„å·®å¼‚è®¡ç®—
- âœ… ç‰ˆæœ¬é“¾å¼å­˜å‚¨
- âœ… Delta åº”ç”¨é€»è¾‘ï¼ˆåŸºç¡€ï¼‰

**1.4 å­˜å‚¨å¼•æ“** (`engine.rs`)
- âœ… å¼•æ“é…ç½®æ¡†æ¶
- âœ… ç¼“å­˜æ¡ç›®å®šä¹‰
- âœ… å†™å…¥ä»»åŠ¡å®šä¹‰
- âœ… é¢„è¯»çª—å£å®šä¹‰

#### âš ï¸ éƒ¨åˆ†å®Œæˆ

- âš ï¸ **å¼•æ“é…ç½®** - åŸºç¡€é…ç½®å®Œæˆï¼Œé«˜çº§ä¼˜åŒ–å‚æ•°æœªå…¨éƒ¨åº”ç”¨
- âš ï¸ **ç¼“å­˜ç®¡ç†** - ä½¿ç”¨ moka æ¡†æ¶æ­å»ºï¼Œä½†å®é™…ç¼“å­˜é€»è¾‘æœªå®ç°
- âš ï¸ **å†™å…¥é˜Ÿåˆ—** - `WriteTask` å®šä¹‰å®Œæˆï¼Œé˜Ÿåˆ—ç®¡ç†æœªå®ç°
- âš ï¸ **MVCC** - å®šä¹‰äº†å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ç»“æ„ï¼Œä½†é€»è¾‘ä¸å®Œæ•´

#### âŒ æœªå®ç°

- âŒ **é¢„è¯»ç­–ç•¥** - `ReadaheadWindow` ä»…å®šä¹‰ç»“æ„ï¼Œæœªå®é™…ä½¿ç”¨
- âŒ **å†™æ”¾å¤§æ§åˆ¶** - ç›‘æ§ä»£ç æ¡†æ¶å­˜åœ¨ï¼Œæ§åˆ¶é€»è¾‘ç¼ºå¤±
- âŒ **å¹¶å‘æ§åˆ¶ä¼˜åŒ–** - `Semaphore` å®šä¹‰ä½†æœªå®é™…åº”ç”¨
- âŒ **é”ç«äº‰ä¼˜åŒ–** - è®¾è®¡æ–‡æ¡£æåˆ°ä½†æœªå®ç°

### 2. æœåŠ¡å±‚ (60% å®Œæˆ)

#### 2.1 å»é‡æœåŠ¡ (`dedup.rs` - 70%)

**âœ… å·²å®ç°ï¼š**
- âœ… å—å“ˆå¸Œæ˜ å°„ (`BlockRef`)
- âœ… å¼•ç”¨è®¡æ•°ç®¡ç†
- âœ… å»é‡ç»Ÿè®¡ä¿¡æ¯ (`DedupStats`)
- âœ… å»é‡é…ç½® (`DedupConfig`)
- âœ… æ–‡ä»¶IDé›†åˆç®¡ç†

**âš ï¸ éƒ¨åˆ†å®ç°ï¼š**
- âš ï¸ Copy-on-Write æœºåˆ¶ - å®šä¹‰å®Œæˆï¼Œå®ç°ä¸å®Œæ•´

**âŒ æœªå®ç°ï¼š**
- âŒ æ‰¹é‡å»é‡æ“ä½œ - `batch_size` é…ç½®å­˜åœ¨ä½†æœªä½¿ç”¨
- âŒ å¹¶å‘å»é‡æ§åˆ¶ - `concurrent_threads` æœªå®é™…åº”ç”¨
- âŒ å»é‡æœåŠ¡ä¸»å¾ªç¯
- âŒ åŒæ­¥ä»»åŠ¡è°ƒåº¦

#### 2.2 ç´¢å¼•æœåŠ¡ (`index.rs` - 80%)

**âœ… å·²å®ç°ï¼š**
- âœ… å—ç´¢å¼•ç®¡ç† (`BlockIndex`)
- âœ… å†…å­˜çƒ­ç´¢å¼• + ç£ç›˜æŒä¹…åŒ–
- âœ… å¼•ç”¨è®¡æ•°ç®¡ç†
- âœ… çƒ­ç‚¹æ•°æ®æ ‡è®°
- âœ… ç´¢å¼•åŠ è½½å’Œä¿å­˜
- âœ… å—æŸ¥æ‰¾åŠŸèƒ½

**âš ï¸ éƒ¨åˆ†å®ç°ï¼š**
- âš ï¸ ç´¢å¼•æ¸…ç† - åŸºç¡€é€»è¾‘å­˜åœ¨ï¼Œä¼˜åŒ–ä¸è¶³
- âš ï¸ å†…å­˜é™åˆ¶æ§åˆ¶ - é…ç½®å­˜åœ¨ä½†æœªå¼ºåˆ¶æ‰§è¡Œ

**âŒ æœªå®ç°ï¼š**
- âŒ ç´¢å¼•å‹ç¼©
- âŒ å¢é‡ç´¢å¼•æ›´æ–°
- âŒ ç´¢å¼•é‡å»ºåŠŸèƒ½

#### 2.3 åˆ†å±‚å­˜å‚¨ (`tiering.rs` - 50%)

**âœ… å·²å®ç°ï¼š**
- âœ… å­˜å‚¨å±‚çº§å®šä¹‰ (`StorageTier`: Hot/Warm/Cold)
- âœ… è®¿é—®è®°å½•è¿½è¸ª (`AccessRecord`)
- âœ… LRU çª—å£æ¡†æ¶
- âœ… æ•°æ®é¡¹ä¿¡æ¯ (`DataItem`)
- âœ… å±‚çº§é…ç½® (`TierConfig`)

**âŒ æœªå®ç°ï¼š**
- âŒ è‡ªåŠ¨è¿ç§»é€»è¾‘ - ä»…æœ‰æ¡†æ¶ä»£ç 
- âŒ å±‚çº§å®¹é‡ç®¡ç† - æœªå®é™…æ‰§è¡Œå®¹é‡é™åˆ¶
- âŒ è¿ç§»æ€§èƒ½ä¼˜åŒ– - æ‰¹é‡è¿ç§»æœªå®ç°
- âŒ è¿ç§»ä»»åŠ¡è°ƒåº¦
- âŒ è¿ç§»ç»Ÿè®¡å’Œç›‘æ§

#### 2.4 ç”Ÿå‘½å‘¨æœŸç®¡ç† (`lifecycle.rs` - 50%)

**âœ… å·²å®ç°ï¼š**
- âœ… ç”Ÿå‘½å‘¨æœŸç­–ç•¥å®šä¹‰ (`LifecyclePolicy`)
  - Permanentï¼ˆæ°¸ä¹…ä¿å­˜ï¼‰
  - TTLï¼ˆåŸºäºæ—¶é—´ï¼‰
  - LastAccessï¼ˆåŸºäºè®¿é—®ï¼‰
  - LastModifiedï¼ˆåŸºäºä¿®æ”¹ï¼‰
  - VersionRetentionï¼ˆç‰ˆæœ¬ä¿ç•™ï¼‰
- âœ… ç”Ÿå‘½å‘¨æœŸé…ç½® (`LifecycleConfig`)
- âœ… ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ (`LifecycleState`)
- âœ… ç”Ÿå‘½å‘¨æœŸæ¡ç›® (`LifecycleEntry`)

**âŒ æœªå®ç°ï¼š**
- âŒ è‡ªåŠ¨æ¸…ç†ä»»åŠ¡ - æ£€æŸ¥å’Œæ¸…ç†é€»è¾‘ç¼ºå¤±
- âŒ é€šçŸ¥æœºåˆ¶ - `notify_before_cleanup` æœªå®ç°
- âŒ æ¸…ç†ç»Ÿè®¡ - ä¸å®Œæ•´
- âŒ ç­–ç•¥åº”ç”¨é€»è¾‘
- âŒ å®šæ—¶ä»»åŠ¡è°ƒåº¦

### 3. å¢é‡å­˜å‚¨ (`storage.rs` - 75%)

#### âœ… å·²å®Œæˆï¼š

- âœ… **ç‰ˆæœ¬ç®¡ç†**
  - `save_version` - ä¿å­˜æ–‡ä»¶ç‰ˆæœ¬ï¼ˆä½¿ç”¨å¢é‡å­˜å‚¨ï¼‰
  - `read_version_data` - è¯»å–ç‰ˆæœ¬æ•°æ®ï¼ˆç‰ˆæœ¬é“¾é‡å»ºï¼‰
  - `get_version_info` - è·å–ç‰ˆæœ¬ä¿¡æ¯
  - `list_file_versions` - åˆ—å‡ºæ–‡ä»¶çš„æ‰€æœ‰ç‰ˆæœ¬

- âœ… **å—ç®¡ç†**
  - `save_chunk` - ä¿å­˜å—æ•°æ®
  - `read_chunk` - è¯»å–å—æ•°æ®
  - å—è·¯å¾„ç®¡ç†

- âœ… **Delta ç®¡ç†**
  - `save_delta` - ä¿å­˜å·®å¼‚æ•°æ®
  - `read_delta` - è¯»å–å·®å¼‚æ•°æ®

- âœ… **ç´¢å¼•ç®¡ç†**
  - ç‰ˆæœ¬ç´¢å¼•ç¼“å­˜ï¼ˆå†…å­˜ + RwLockï¼‰
  - å—ç´¢å¼•ç¼“å­˜ï¼ˆå†…å­˜ + RwLockï¼‰
  - `load_version_index` - åŠ è½½ç‰ˆæœ¬ç´¢å¼•
  - `load_block_index` - åŠ è½½å—ç´¢å¼•

- âœ… **ç»Ÿè®¡åŠŸèƒ½**
  - `get_storage_stats` - å­˜å‚¨ç»Ÿè®¡ä¿¡æ¯

#### âŒ æœªå®ç°ï¼š

- âŒ **ç‰ˆæœ¬åˆ é™¤** - ç‰ˆæœ¬é“¾æ¸…ç†é€»è¾‘ç¼ºå¤±
- âŒ **åƒåœ¾å›æ”¶** - å­¤ç«‹å—æ¸…ç†æœºåˆ¶æœªå®ç°
- âŒ **å—å¼•ç”¨è®¡æ•°** - å®šä¹‰ä½†æœªå®é™…åº”ç”¨äºæ¸…ç†
- âŒ **ç‰ˆæœ¬åˆå¹¶** - åˆå¹¶æ—§ç‰ˆæœ¬ä»¥ä¼˜åŒ–å­˜å‚¨
- âŒ **ç‰ˆæœ¬å‹ç¼©** - å‹ç¼©ç‰ˆæœ¬é“¾
- âŒ **æŸåæ£€æµ‹** - æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
- âŒ **ä¿®å¤åŠŸèƒ½** - æŸåæ•°æ®ä¿®å¤

### 4. é€‚é…å™¨ (`adapter.rs` - 90%)

#### âœ… å·²å®ç°ï¼š

**StorageManager traitï¼š**
- âœ… `init` - åˆå§‹åŒ–å­˜å‚¨
- âœ… `save_file` - ä¿å­˜æ–‡ä»¶ï¼ˆåˆ›å»ºç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼‰
- âœ… `save_at_path` - æŒ‰è·¯å¾„ä¿å­˜
- âœ… `read_file` - è¯»å–æ–‡ä»¶æœ€æ–°ç‰ˆæœ¬
- âœ… `delete_file` - åˆ é™¤æ–‡ä»¶ï¼ˆå«ç‰ˆæœ¬é“¾æ¸…ç†ï¼‰âœ¨ **æ–°å¢**
- âœ… `get_metadata` - è·å–æ–‡ä»¶å…ƒæ•°æ®
- âœ… `file_exists` - æ£€æŸ¥æ–‡ä»¶å­˜åœ¨æ€§
- âœ… `list_files` - åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶ âœ¨ **æ–°å¢**
- âœ… `verify_hash` - éªŒè¯å“ˆå¸Œå€¼

**S3CompatibleStorageTrait traitï¼š**
- âœ… `create_bucket` - åˆ›å»ºbucket
- âœ… `delete_bucket` - åˆ é™¤bucket
- âœ… `bucket_exists` - æ£€æŸ¥bucketå­˜åœ¨
- âœ… `list_buckets` - åˆ—å‡ºbuckets
- âœ… `list_bucket_objects` - åˆ—å‡ºå¯¹è±¡

#### âœ… æ–°å¢åŠŸèƒ½ï¼š

- âœ… **æ–‡ä»¶åˆ é™¤** - å®Œæ•´çš„ç‰ˆæœ¬é“¾æ¸…ç†
  - åˆ é™¤æ‰€æœ‰ç‰ˆæœ¬
  - é€’å‡å—å¼•ç”¨è®¡æ•°
  - æ¸…ç†å­¤ç«‹æ•°æ®

- âœ… **æ–‡ä»¶åˆ—è¡¨** - åŸºäºæ–‡ä»¶ç´¢å¼•çš„å¿«é€Ÿåˆ—è¡¨
  - æ–‡ä»¶IDåˆ—è¡¨
  - æ–‡ä»¶å…ƒæ•°æ®èšåˆ
  - é«˜æ€§èƒ½æŸ¥è¯¢

- âœ… **æ–‡ä»¶ç´¢å¼•ç®¡ç†**
  - è‡ªåŠ¨æ„å»ºå’Œç»´æŠ¤
  - æŒä¹…åŒ–å­˜å‚¨
  - å¢é‡æ›´æ–°

- âœ… **å—å¼•ç”¨è®¡æ•°**
  - è‡ªåŠ¨è·Ÿè¸ªå—å¼•ç”¨
  - æ”¯æŒåƒåœ¾å›æ”¶
  - æŒä¹…åŒ–å­˜å‚¨

- âœ… **åƒåœ¾å›æ”¶**
  - è‡ªåŠ¨æ¸…ç†å­¤ç«‹å—
  - ç©ºé—´å›æ”¶ç»Ÿè®¡
  - é”™è¯¯æŠ¥å‘Š

#### âš ï¸ æ€§èƒ½ä¼˜åŒ–ç©ºé—´ï¼š

- âš ï¸ æ–‡ä»¶åˆ—è¡¨æ€§èƒ½å¯è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆå½“å‰ä»ç´¢å¼•è¯»å–ï¼Œå·²è¶³å¤Ÿå¿«ï¼‰
- âš ï¸ åˆ é™¤æ“ä½œå¯ä»¥å¼‚æ­¥åŒ–ä»¥æå‡å“åº”é€Ÿåº¦

---

## ğŸ“ˆ åŠŸèƒ½å®Œæ•´åº¦è¯„åˆ†

| åŠŸèƒ½æ¨¡å— | V1 å®Œæ•´åº¦ | V2 å®Œæ•´åº¦ | V2 ä¸»è¦ç¼ºå¤± |
|---------|----------|----------|------------|
| **åŸºç¡€æ–‡ä»¶æ“ä½œ** | 100% | 95% âœ¨ | æ€§èƒ½ä¼˜åŒ–ç©ºé—´ |
| **S3 å…¼å®¹æ€§** | 100% | 90% âœ¨ | ç‰ˆæœ¬æ„ŸçŸ¥çš„å¯¹è±¡ç®¡ç† |
| **ç‰ˆæœ¬ç®¡ç†** | N/A | 90% âœ¨ | ç‰ˆæœ¬åˆå¹¶ã€å‹ç¼© |
| **å—çº§å»é‡** | N/A | 70% | æ‰¹é‡å»é‡ã€CoW å®ç° |
| **å‹ç¼©åŠŸèƒ½** | N/A | 80% | è‡ªåŠ¨å‹ç¼©è§¦å‘ |
| **åˆ†å±‚å­˜å‚¨** | N/A | 50% | è‡ªåŠ¨è¿ç§»ã€å®¹é‡ç®¡ç† |
| **ç”Ÿå‘½å‘¨æœŸ** | N/A | 50% | è‡ªåŠ¨æ¸…ç†ã€é€šçŸ¥ |
| **æ€§èƒ½ä¼˜åŒ–** | 95% | 40% | ç¼“å­˜ã€é¢„è¯»ã€å¹¶å‘æ§åˆ¶ |
| **é”™è¯¯å¤„ç†** | 100% | 95% âœ¨ | éƒ¨åˆ†è¾¹ç•Œæƒ…å†µ |
| **æµ‹è¯•è¦†ç›–** | 90% | 50% âœ¨ | é«˜çº§åŠŸèƒ½æµ‹è¯• |

### è¯¦ç»†è¯„åˆ†è¯´æ˜

#### V1 çš„ä¼˜åŠ¿ï¼š
- âœ… åŠŸèƒ½å®Œæ•´ï¼Œæ— æ˜æ˜¾ç¼ºå¤±
- âœ… ä»£ç ç®€æ´ï¼Œæ˜“äºç»´æŠ¤
- âœ… æµ‹è¯•è¦†ç›–å……åˆ†
- âœ… æ€§èƒ½ç¨³å®šå¯é 
- âœ… é”™è¯¯å¤„ç†å®Œå–„

#### V2 çš„ä¼˜åŠ¿ï¼š
- âœ… æ¶æ„å…ˆè¿›ï¼Œè®¾è®¡åˆç†
- âœ… æ”¯æŒç‰ˆæœ¬ç®¡ç†
- âœ… å—çº§å»é‡èƒ½åŠ›
- âœ… å‹ç¼©ç®—æ³•ä¸°å¯Œ
- âœ… å¯æ‰©å±•æ€§å¼º
- âœ… **åŸºç¡€æ–‡ä»¶æ“ä½œå®Œæ•´** âœ¨ **æ–°å¢**

#### V2 çš„åŠ£åŠ¿ï¼š
- âš ï¸ éƒ¨åˆ†é«˜çº§åŠŸèƒ½æœªå®Œæˆï¼ˆåˆ†å±‚ã€ç”Ÿå‘½å‘¨æœŸï¼‰
- âš ï¸ æ€§èƒ½ä¼˜åŒ–æœªå®Œæˆ
- âš ï¸ æµ‹è¯•è¦†ç›–éœ€è¦å¢å¼º
- âš ï¸ æ–‡æ¡£ä¸å®Œæ•´
- âš ï¸ ç”Ÿäº§ç¯å¢ƒéœ€è¦æ›´å¤šéªŒè¯

---

## ğŸ¯ V2 ä¸»è¦ç¼ºå¤±åŠŸèƒ½æ¸…å•

### ~~ğŸ”´ P0 - å…³é”®ç¼ºå¤± (é˜»ç¢ç”Ÿäº§ä½¿ç”¨)~~ âœ… **å·²å®Œæˆï¼**

1. ~~âŒ **æ–‡ä»¶åˆ é™¤åŠŸèƒ½**~~ âœ… **å·²å®ç°**
   - âœ… å®ç°ç‰ˆæœ¬é“¾æ¸…ç†
   - âœ… å—å¼•ç”¨è®¡æ•°é€’å‡
   - âœ… å­¤ç«‹å—æ ‡è®°å’Œæ¸…ç†

2. ~~âŒ **æ–‡ä»¶åˆ—è¡¨åŠŸèƒ½**~~ âœ… **å·²å®ç°**
   - âœ… æ–‡ä»¶çº§åˆ«ç´¢å¼•
   - âœ… å¿«é€ŸæŸ¥è¯¢ä¼˜åŒ–
   - âœ… ç´¢å¼•æŒä¹…åŒ–

3. ~~âŒ **åƒåœ¾å›æ”¶æœºåˆ¶**~~ âœ… **å·²å®ç°**
   - âœ… å—å¼•ç”¨è®¡æ•°ç®¡ç†
   - âœ… å­¤ç«‹å—æ‰«æ
   - âœ… æ‰‹åŠ¨GCè§¦å‘
   - âœ… ç©ºé—´å›æ”¶ç»Ÿè®¡

4. âš ï¸ **å®Œæ•´çš„é”™è¯¯æ¢å¤** - éƒ¨åˆ†å®Œæˆ
   - âœ… åŸºç¡€é”™è¯¯å¤„ç†
   - âš ï¸ äº‹åŠ¡æ€§æ“ä½œ - å¾…å®Œå–„
   - âš ï¸ å´©æºƒæ¢å¤ - å¾…å®Œå–„
   - âš ï¸ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ - å¾…å®Œå–„

### ğŸŸ¡ P1 - é«˜çº§åŠŸèƒ½æœªå®Œæˆ (å½±å“æ€§èƒ½/æ•ˆç‡)

5. âš ï¸ **é¢„è¯»ç­–ç•¥**
   - å½±å“ï¼šé¡ºåºè¯»å–æ€§èƒ½æœªä¼˜åŒ–
   - ä½ç½®ï¼š`engine.rs:103`
   - éœ€è¦ï¼šå®ç°é¢„è¯»çª—å£ç®¡ç†å’Œé¢„åŠ è½½é€»è¾‘

6. âš ï¸ **å†™å…¥é˜Ÿåˆ—**
   - å½±å“ï¼šå†™å…¥æ€§èƒ½æœªä¼˜åŒ–ï¼Œæ— æ³•æ‰¹é‡å¤„ç†
   - ä½ç½®ï¼š`engine.rs:89`
   - éœ€è¦ï¼šå®ç°å†™å…¥é˜Ÿåˆ—ç®¡ç†å’Œæ‰¹é‡åˆ·æ–°

7. âš ï¸ **MVCC å®Œæ•´å®ç°**
   - å½±å“ï¼šå¹¶å‘è¯»å†™å¯èƒ½å­˜åœ¨å†²çª
   - ä½ç½®ï¼š`engine.rs`
   - éœ€è¦ï¼šå®Œæ•´çš„å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶é€»è¾‘

8. âš ï¸ **æ‰¹é‡å»é‡**
   - å½±å“ï¼šå»é‡æ•ˆç‡ä½
   - ä½ç½®ï¼š`dedup.rs`
   - éœ€è¦ï¼šå®ç°æ‰¹é‡å»é‡æ“ä½œ

9. âš ï¸ **è‡ªåŠ¨åˆ†å±‚è¿ç§»**
   - å½±å“ï¼šå†·çƒ­æ•°æ®åˆ†ç¦»æ— æ³•è‡ªåŠ¨è¿›è¡Œ
   - ä½ç½®ï¼š`tiering.rs`
   - éœ€è¦ï¼šå®ç°è‡ªåŠ¨è¿ç§»è°ƒåº¦å’Œæ‰§è¡Œé€»è¾‘

10. âš ï¸ **è‡ªåŠ¨ç”Ÿå‘½å‘¨æœŸæ¸…ç†**
    - å½±å“ï¼šè¿‡æœŸæ•°æ®æ— æ³•è‡ªåŠ¨æ¸…ç†
    - ä½ç½®ï¼š`lifecycle.rs`
    - éœ€è¦ï¼šå®ç°å®šæ—¶ä»»åŠ¡å’Œæ¸…ç†é€»è¾‘

### ğŸŸ¢ P2 - ä¼˜åŒ–éœ€æ±‚ (å¯åç»­å®Œå–„)

11. ğŸ“ **æ€§èƒ½æµ‹è¯•ä¸è¶³**
    - ä½ç½®ï¼š`bench.rs`
    - éœ€è¦ï¼šå®Œå–„çš„æ€§èƒ½åŸºå‡†æµ‹è¯•

12. ğŸ“ **å¹¶å‘æµ‹è¯•ç¼ºå¤±**
    - éœ€è¦ï¼šå¤šçº¿ç¨‹å¹¶å‘åœºæ™¯æµ‹è¯•

13. ğŸ“ **æ–‡æ¡£ä¸å®Œæ•´**
    - éœ€è¦ï¼šé«˜çº§åŠŸèƒ½çš„ä½¿ç”¨æ–‡æ¡£å’Œæœ€ä½³å®è·µ

14. ğŸ“ **ç›‘æ§æŒ‡æ ‡**
    - éœ€è¦ï¼šè¯¦ç»†çš„æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡æŒ‡æ ‡

15. ğŸ“ **ç´¢å¼•ä¼˜åŒ–**
    - éœ€è¦ï¼šæ›´é«˜æ•ˆçš„ç´¢å¼•ç»“æ„ï¼ˆB-Treeã€LSMç­‰ï¼‰

16. ğŸ“ **è‡ªåŠ¨GCè°ƒåº¦**
    - å½“å‰ï¼šéœ€æ‰‹åŠ¨è°ƒç”¨ `garbage_collect()`
    - éœ€è¦ï¼šåå°è‡ªåŠ¨GCä»»åŠ¡

---

## âœ¨ V2 æœ€æ–°æ”¹è¿›ï¼ˆ2025å¹´11æœˆ13æ—¥ï¼‰

### å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½

1. **æ–‡ä»¶åˆ é™¤åŠŸèƒ½** âœ…
   - å®Œæ•´çš„ç‰ˆæœ¬é“¾æ¸…ç†é€»è¾‘
   - è‡ªåŠ¨é€’å‡å—å¼•ç”¨è®¡æ•°
   - åˆ é™¤ç‰ˆæœ¬å…ƒæ•°æ®å’Œdeltaæ–‡ä»¶
   - æ¸…ç†æ–‡ä»¶ç´¢å¼•
   - æµ‹è¯•è¦†ç›–ï¼š`test_delete_file`

2. **æ–‡ä»¶åˆ—è¡¨åŠŸèƒ½** âœ…
   - åŸºäºæ–‡ä»¶ç´¢å¼•çš„é«˜æ•ˆåˆ—è¡¨
   - è‡ªåŠ¨ç»´æŠ¤æ–‡ä»¶ç´¢å¼•
   - ç´¢å¼•æŒä¹…åŒ–åˆ°ç£ç›˜
   - æ”¯æŒç´¢å¼•é‡å»º
   - æµ‹è¯•è¦†ç›–ï¼š`test_list_files`

3. **åƒåœ¾å›æ”¶æœºåˆ¶** âœ…
   - å—å¼•ç”¨è®¡æ•°ç®¡ç†
   - å­¤ç«‹å—è‡ªåŠ¨è¯†åˆ«å’Œæ¸…ç†
   - ç©ºé—´å›æ”¶ç»Ÿè®¡
   - é”™è¯¯æŠ¥å‘Šæœºåˆ¶
   - æµ‹è¯•è¦†ç›–ï¼š`test_garbage_collect`

4. **æ–‡ä»¶ç´¢å¼•ç³»ç»Ÿ** âœ…
   - `FileIndexEntry` ç»“æ„
   - è‡ªåŠ¨è·Ÿè¸ªæ–‡ä»¶ç‰ˆæœ¬
   - æœ€æ–°ç‰ˆæœ¬å¿«é€ŸæŸ¥è¯¢
   - åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´
   - æµ‹è¯•è¦†ç›–ï¼š`test_get_file_info`

5. **å—å¼•ç”¨è®¡æ•°ç³»ç»Ÿ** âœ…
   - `ChunkRefCount` ç»“æ„
   - è‡ªåŠ¨å¢å‡å¼•ç”¨è®¡æ•°
   - æŒä¹…åŒ–åˆ°ç£ç›˜
   - æ”¯æŒé‡å»º
   - æµ‹è¯•è¦†ç›–ï¼š`test_chunk_ref_count`

### æ–°å¢API

```rust
// storage.rs
impl IncrementalStorage {
    // æ–‡ä»¶æ“ä½œ
    pub async fn list_files(&self) -> Result<Vec<String>>;
    pub async fn delete_file(&self, file_id: &str) -> Result<()>;
    pub async fn get_file_info(&self, file_id: &str) -> Result<FileIndexEntry>;

    // åƒåœ¾å›æ”¶
    pub async fn garbage_collect(&self) -> Result<GarbageCollectResult>;

    // ç´¢å¼•ç®¡ç†ï¼ˆå†…éƒ¨ï¼‰
    async fn load_chunk_ref_count(&self) -> Result<()>;
    async fn save_chunk_ref_count(&self) -> Result<()>;
    async fn rebuild_chunk_ref_count(&self) -> Result<()>;
    async fn load_file_index(&self) -> Result<()>;
    async fn save_file_index(&self) -> Result<()>;
    async fn rebuild_file_index(&self) -> Result<()>;
}
```

### æ–°å¢æ•°æ®ç»“æ„

```rust
// æ–‡ä»¶ç´¢å¼•
pub struct FileIndexEntry {
    pub file_id: String,
    pub latest_version_id: String,
    pub version_count: usize,
    pub created_at: NaiveDateTime,
    pub modified_at: NaiveDateTime,
}

// å—å¼•ç”¨è®¡æ•°
struct ChunkRefCount {
    chunk_id: String,
    ref_count: usize,
    size: u64,
    path: PathBuf,
}

// åƒåœ¾å›æ”¶ç»“æœ
pub struct GarbageCollectResult {
    pub orphaned_chunks: usize,
    pub reclaimed_space: u64,
    pub errors: Vec<String>,
}
```

### æµ‹è¯•å¢å¼º

æ–°å¢5ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæ€»æµ‹è¯•æ•°ä»47ä¸ªå¢åŠ åˆ°52ä¸ªï¼š
- âœ… `test_list_files` - æ–‡ä»¶åˆ—è¡¨æµ‹è¯•
- âœ… `test_delete_file` - æ–‡ä»¶åˆ é™¤æµ‹è¯•
- âœ… `test_garbage_collect` - åƒåœ¾å›æ”¶æµ‹è¯•
- âœ… `test_get_file_info` - æ–‡ä»¶ä¿¡æ¯æŸ¥è¯¢æµ‹è¯•
- âœ… `test_chunk_ref_count` - å—å¼•ç”¨è®¡æ•°æµ‹è¯•

æ‰€æœ‰52ä¸ªæµ‹è¯•å‡é€šè¿‡ âœ…

---

## ğŸ” ä»£ç è´¨é‡å¯¹æ¯”

### Storage V1

```rust
// ä¼˜ç‚¹ï¼š
âœ… ä»£ç ç®€æ´æ¸…æ™°ï¼ˆ527è¡Œï¼‰
âœ… å•ä¸€èŒè´£åŸåˆ™
âœ… é”™è¯¯å¤„ç†å®Œå–„
âœ… æµ‹è¯•è¦†ç›–å……åˆ†

// ç¤ºä¾‹ï¼šæ¸…æ™°çš„æ–‡ä»¶ä¿å­˜é€»è¾‘
pub async fn save_file(&self, file_id: &str, data: &[u8]) -> Result<FileMetadata> {
    let file_path = self.get_file_path(file_id);
    // åˆ›å»ºçˆ¶ç›®å½•
    if let Some(parent) = file_path.parent() {
        fs::create_dir_all(parent).await?;
    }
    // å†™å…¥æ–‡ä»¶
    let mut file = fs::File::create(&file_path).await?;
    file.write_all(data).await?;
    file.flush().await?;
    // è¿”å›å…ƒæ•°æ®
    // ...
}
```

### Storage V2

```rust
// ä¼˜ç‚¹ï¼š
âœ… æ¶æ„æ¸…æ™°ï¼ŒèŒè´£åˆ†ç¦»
âœ… é«˜çº§åŠŸèƒ½è®¾è®¡å®Œå–„
âœ… å¯æ‰©å±•æ€§å¼º

// ç¼ºç‚¹ï¼š
âŒ ä»£ç å¤æ‚åº¦é«˜ï¼ˆ3000+è¡Œï¼‰
âŒ éƒ¨åˆ†åŠŸèƒ½æœªå®Œæˆ
âŒ æµ‹è¯•è¦†ç›–ä¸è¶³

// ç¤ºä¾‹ï¼šå¤æ‚çš„ç‰ˆæœ¬ä¿å­˜é€»è¾‘
pub async fn save_version(
    &self,
    file_id: &str,
    data: &[u8],
    parent_version_id: Option<&str>,
) -> Result<(FileDelta, FileVersion)> {
    // 1. ç”Ÿæˆå·®å¼‚
    // 2. ä¿å­˜å—æ•°æ®
    // 3. ä¿å­˜å·®å¼‚æ•°æ®
    // 4. ä¿å­˜ç‰ˆæœ¬ä¿¡æ¯
    // 5. æ›´æ–°ç´¢å¼•
    // ... å¤šä¸ªæ­¥éª¤ï¼Œå¤æ‚åº¦é«˜
}
```

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### é€‰æ‹© Storage V1 çš„åœºæ™¯

âœ… **æ¨èä½¿ç”¨ V1 å½“ï¼š**
- éœ€è¦ç¨³å®šå¯é çš„æ–‡ä»¶å­˜å‚¨
- ä¸éœ€è¦ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½
- å¯¹å»é‡éœ€æ±‚ä¸é«˜
- è¿½æ±‚ä»£ç ç®€æ´å’Œæ˜“ç»´æŠ¤æ€§
- éœ€è¦å¿«é€Ÿéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- S3/WebDAV å…¼å®¹æ€§æ˜¯ä¸»è¦éœ€æ±‚

**é€‚ç”¨æ¡ˆä¾‹ï¼š**
- ä¸ªäººç½‘ç›˜
- æ–‡ä»¶å…±äº«æœåŠ¡
- ç®€å•çš„å¯¹è±¡å­˜å‚¨
- WebDAV æœåŠ¡å™¨
- S3 å…¼å®¹å­˜å‚¨

### é€‰æ‹© Storage V2 çš„åœºæ™¯ï¼ˆå¾…å®Œå–„åï¼‰

âš ï¸ **V2 é€‚åˆä½†éœ€è¦å®Œå–„åä½¿ç”¨ï¼š**
- éœ€è¦å®Œæ•´çš„ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½
- å¤§é‡é‡å¤æ•°æ®éœ€è¦å»é‡
- éœ€è¦å†·çƒ­æ•°æ®åˆ†ç¦»
- å¯¹å­˜å‚¨æ•ˆç‡è¦æ±‚é«˜
- éœ€è¦æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†

**æ½œåœ¨é€‚ç”¨æ¡ˆä¾‹ï¼ˆå®Œå–„åï¼‰ï¼š**
- Git-like ç‰ˆæœ¬æ§åˆ¶å­˜å‚¨
- å¤‡ä»½ç³»ç»Ÿ
- ä¼ä¸šæ–‡æ¡£ç®¡ç†
- å¤§è§„æ¨¡æ•°æ®å½’æ¡£
- äº‘å­˜å‚¨æœåŠ¡

### è¿ç§»å»ºè®®

å¦‚æœè®¡åˆ’ä» V1 è¿ç§»åˆ° V2ï¼š

1. **ç­‰å¾… V2 å®Œå–„**
   - è‡³å°‘å®Œæˆ P0 çº§åˆ«çš„åŠŸèƒ½
   - é€šè¿‡å®Œæ•´çš„é›†æˆæµ‹è¯•
   - è¿›è¡Œæ€§èƒ½å‹æµ‹éªŒè¯

2. **åˆ†é˜¶æ®µè¿ç§»**
   - å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
   - å°è§„æ¨¡ç°åº¦å‘å¸ƒ
   - é€æ­¥æ‰©å¤§ä½¿ç”¨èŒƒå›´

3. **ä¿ç•™ V1 å¤‡ä»½**
   - V1 ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ
   - æ•°æ®åŒå†™ä¸€æ®µæ—¶é—´
   - ç¡®è®¤ V2 ç¨³å®šåå®Œå…¨åˆ‡æ¢

---

## ğŸ“… V2 å¼€å‘è·¯çº¿å›¾ï¼ˆå·²æ›´æ–°ï¼‰

### ~~Phase 1: æ ¸å¿ƒåŠŸèƒ½è¡¥å…¨ (2-3å‘¨)~~ âœ… **å·²å®Œæˆï¼**

**ç›®æ ‡ï¼š** è¾¾åˆ° V1 çš„åŠŸèƒ½å®Œæ•´åº¦

- [x] å®ç°æ–‡ä»¶åˆ é™¤åŠŸèƒ½
  - [x] ç‰ˆæœ¬é“¾æ¸…ç†é€»è¾‘
  - [x] å—å¼•ç”¨è®¡æ•°é€’å‡
  - [x] å­¤ç«‹å—æ ‡è®°

- [x] å®ç°æ–‡ä»¶åˆ—è¡¨åŠŸèƒ½
  - [x] æ–‡ä»¶çº§åˆ«ç´¢å¼•
  - [x] å¿«é€ŸæŸ¥è¯¢ä¼˜åŒ–
  - [x] ç´¢å¼•æŒä¹…åŒ–

- [x] å®ç°åƒåœ¾å›æ”¶æœºåˆ¶
  - [x] å¼•ç”¨è®¡æ•°ç®¡ç†
  - [x] å­¤ç«‹å—æ‰«æ
  - [x] æ‰‹åŠ¨GCè§¦å‘

- [ ] å®Œå–„é”™è¯¯æ¢å¤ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰
  - [x] åŸºç¡€é”™è¯¯å¤„ç†
  - [ ] äº‹åŠ¡æ€§æ“ä½œ
  - [ ] å´©æºƒæ¢å¤
  - [ ] æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

### Phase 2: æµ‹è¯•ä¸éªŒè¯ (2-3å‘¨) ğŸ”„ **è¿›è¡Œä¸­**

**ç›®æ ‡ï¼š** ç¡®ä¿è´¨é‡å’Œç¨³å®šæ€§

- [ ] å®Œå–„æµ‹è¯•è¦†ç›–
  - [x] æ ¸å¿ƒåŠŸèƒ½å•å…ƒæµ‹è¯•
  - [ ] é›†æˆæµ‹è¯•åœºæ™¯
  - [ ] æ€§èƒ½å‹æµ‹
  - [ ] å¹¶å‘æµ‹è¯•
  - [ ] è¾¹ç•Œæ¡ä»¶æµ‹è¯•

- [ ] å®Œå–„æ–‡æ¡£
  - [ ] API æ–‡æ¡£
  - [ ] ä½¿ç”¨æŒ‡å—
  - [ ] è¿ç§»æŒ‡å—
  - [ ] æ•…éšœæ’é™¤

- [ ] æ€§èƒ½éªŒè¯
  - [ ] æ€§èƒ½åŸºå‡†å»ºç«‹
  - [ ] ä¸ V1 å¯¹æ¯”
  - [ ] ç“¶é¢ˆåˆ†æ

- [ ] ç”Ÿäº§ç¯å¢ƒå‡†å¤‡
  - [ ] ç›‘æ§æŒ‡æ ‡æ¥å…¥
  - [ ] æ—¥å¿—å®Œå–„
  - [ ] è¿ç»´å·¥å…·

### Phase 3: æ€§èƒ½ä¼˜åŒ– (1-2å‘¨) ğŸ“‹ **å¾…å¼€å§‹**

**ç›®æ ‡ï¼š** è¾¾åˆ°å¹¶è¶…è¶Š V1 çš„æ€§èƒ½

- [ ] å®ç°ç¼“å­˜æœºåˆ¶
  - çƒ­æ•°æ®ç¼“å­˜
  - ç¼“å­˜æ·˜æ±°ç­–ç•¥
  - ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§

- [ ] å®ç°é¢„è¯»ç­–ç•¥
  - é¡ºåºè®¿é—®æ£€æµ‹
  - é¢„è¯»çª—å£ç®¡ç†
  - é¢„è¯»æ•°æ®åŠ è½½

- [ ] å®ç°å†™å…¥é˜Ÿåˆ—
  - æ‰¹é‡å†™å…¥ä¼˜åŒ–
  - å†™å…¥åˆå¹¶
  - å¼‚æ­¥åˆ·æ–°

- [ ] å®Œå–„å¹¶å‘æ§åˆ¶
  - è¯»å†™é”ä¼˜åŒ–
  - æ— é”æ•°æ®ç»“æ„
  - å¹¶å‘æµ‹è¯•éªŒè¯

### Phase 4: é«˜çº§åŠŸèƒ½ (2-3å‘¨) ğŸ“‹ **å¾…å¼€å§‹**

**ç›®æ ‡ï¼š** å‘æŒ¥ V2 çš„ä¼˜åŠ¿

- [ ] å®Œæˆæ‰¹é‡å»é‡
  - æ‰¹é‡å¤„ç†é€»è¾‘
  - å¹¶å‘å»é‡
  - å»é‡æ•ˆç‡ä¼˜åŒ–

- [ ] å®Œæˆè‡ªåŠ¨åˆ†å±‚
  - è®¿é—®é¢‘ç‡ç»Ÿè®¡
  - è‡ªåŠ¨è¿ç§»è°ƒåº¦
  - è¿ç§»æ€§èƒ½ä¼˜åŒ–

- [ ] å®Œæˆç”Ÿå‘½å‘¨æœŸç®¡ç†
  - ç­–ç•¥åº”ç”¨é€»è¾‘
  - è‡ªåŠ¨æ¸…ç†ä»»åŠ¡
  - æ¸…ç†é€šçŸ¥æœºåˆ¶

- [ ] ç‰ˆæœ¬ç®¡ç†å¢å¼º
  - ç‰ˆæœ¬åˆå¹¶
  - ç‰ˆæœ¬å‹ç¼©
  - ç‰ˆæœ¬åˆ†æ”¯æ”¯æŒ

### Phase 4: æµ‹è¯•ä¸æ–‡æ¡£ (1å‘¨)

**ç›®æ ‡ï¼š** ç”Ÿäº§å°±ç»ª

- [ ] å®Œå–„æµ‹è¯•è¦†ç›–
  - å•å…ƒæµ‹è¯• > 80%
  - é›†æˆæµ‹è¯•åœºæ™¯
  - æ€§èƒ½å‹æµ‹
  - å¹¶å‘æµ‹è¯•
  - è¾¹ç•Œæ¡ä»¶æµ‹è¯•

- [ ] å®Œå–„æ–‡æ¡£
  - API æ–‡æ¡£
  - ä½¿ç”¨æŒ‡å—
  - æœ€ä½³å®è·µ
  - è¿ç§»æŒ‡å—
  - æ•…éšœæ’é™¤

- [ ] æ€§èƒ½è°ƒä¼˜
  - æ€§èƒ½åŸºå‡†å»ºç«‹
  - ç“¶é¢ˆåˆ†æå’Œä¼˜åŒ–
  - å†…å­˜ä½¿ç”¨ä¼˜åŒ–

- [ ] ç”Ÿäº§ç¯å¢ƒå‡†å¤‡
  - ç›‘æ§æŒ‡æ ‡æ¥å…¥
  - æ—¥å¿—å®Œå–„
  - è¿ç»´å·¥å…·

**é¢„è®¡æ€»å·¥ä½œé‡ï¼š** 6-9å‘¨è¾¾åˆ°ç”Ÿäº§å°±ç»ªçŠ¶æ€

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”ï¼ˆç†è®ºé¢„æœŸï¼‰

| æŒ‡æ ‡ | Storage V1 | Storage V2 (å½“å‰) | Storage V2 (å®Œå–„åé¢„æœŸ) |
|------|-----------|------------------|----------------------|
| **å†™å…¥æ€§èƒ½** | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ |
| **è¯»å–æ€§èƒ½** | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ |
| **å­˜å‚¨æ•ˆç‡** | â­â­â­ | â­â­â­â­ | â­â­â­â­â­ |
| **å¹¶å‘æ€§èƒ½** | â­â­â­â­ | â­â­ | â­â­â­â­â­ |
| **å†…å­˜ä½¿ç”¨** | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ |
| **CPU ä½¿ç”¨** | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ |

### æ€§èƒ½è¯´æ˜

**V1 çš„æ€§èƒ½ç‰¹ç‚¹ï¼š**
- ç®€å•ç›´æ¥çš„æ–‡ä»¶æ“ä½œï¼Œæ€§èƒ½ç¨³å®š
- æ— é¢å¤–çš„è®¡ç®—å¼€é”€
- å†…å­˜å ç”¨ä½
- é€‚åˆé€šç”¨åœºæ™¯

**V2 çš„æ€§èƒ½æ½œåŠ›ï¼š**
- å»é‡å¯ä»¥èŠ‚çœå¤§é‡å­˜å‚¨ç©ºé—´ï¼ˆç†è®ºå¯è¾¾ 50-80% å¯¹äºé‡å¤æ•°æ®ï¼‰
- å¢é‡å­˜å‚¨å‡å°‘ç½‘ç»œä¼ è¾“å’Œå†™å…¥é‡
- å‹ç¼©å¯ä»¥è¿›ä¸€æ­¥å‡å°‘å­˜å‚¨ç©ºé—´ï¼ˆ10-70% å–å†³äºæ•°æ®ç±»å‹ï¼‰
- åˆ†å±‚å­˜å‚¨å¯ä»¥æå‡çƒ­æ•°æ®è®¿é—®é€Ÿåº¦
- ä½†éœ€è¦é¢å¤–çš„è®¡ç®—èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰

---

## ğŸ”’ æ•°æ®å¯é æ€§å¯¹æ¯”

| æ–¹é¢ | Storage V1 | Storage V2 |
|------|-----------|-----------|
| **æ•°æ®å®Œæ•´æ€§** | âœ… SHA-256 æ ¡éªŒ | âœ… å—çº§ SHA-256 æ ¡éªŒ |
| **å´©æºƒæ¢å¤** | âœ… æ–‡ä»¶ç³»ç»Ÿä¿è¯ | âš ï¸ éœ€è¦å®Œå–„ |
| **æ•°æ®æŸåæ£€æµ‹** | âš ï¸ ä»…å“ˆå¸Œæ ¡éªŒ | âš ï¸ éœ€è¦å¢å¼º |
| **æ•°æ®ä¿®å¤** | âŒ ä¸æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **å¤‡ä»½æœºåˆ¶** | âœ… ç®€å•æ–‡ä»¶å¤åˆ¶ | âš ï¸ éœ€è¦ç‰ˆæœ¬å¯¼å‡ºåŠŸèƒ½ |
| **ä¸€è‡´æ€§ä¿è¯** | âœ… å¼ºä¸€è‡´æ€§ | âš ï¸ éœ€è¦å®Œå–„äº‹åŠ¡ |

---

## ğŸ“‹ ç»“è®ºä¸å»ºè®®

### æ€»ä½“è¯„ä»·

| é¡¹ç›® | Storage V1 | Storage V2 |
|------|-----------|-----------|
| **æˆç†Ÿåº¦** | â­â­â­â­â­ ç”Ÿäº§å°±ç»ª | â­â­â­â­ æ ¸å¿ƒåŠŸèƒ½å®Œæˆ âœ¨ |
| **åŠŸèƒ½å®Œæ•´åº¦** | 100% | ~85% âœ¨ |
| **ä»£ç è´¨é‡** | â­â­â­â­â­ | â­â­â­â­ |
| **å¯ç»´æŠ¤æ€§** | â­â­â­â­â­ | â­â­â­â­ |
| **å¯æ‰©å±•æ€§** | â­â­â­ | â­â­â­â­â­ |
| **é€‚ç”¨åœºæ™¯** | é€šç”¨æ–‡ä»¶å­˜å‚¨ | å¤§è§„æ¨¡ç‰ˆæœ¬ç®¡ç†ã€å»é‡ |
| **å»ºè®®** | âœ… ç›´æ¥ä½¿ç”¨ | âœ… å¯æµ‹è¯•ä½¿ç”¨ âœ¨ |

### æ ¸å¿ƒå»ºè®®

1. **å½“å‰ç”Ÿäº§ç¯å¢ƒï¼šå¯ä»¥å¼€å§‹æµ‹è¯• V2** âœ¨
   - V2 æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ
   - åŸºç¡€æ–‡ä»¶æ“ä½œä¸ V1 å¯¹ç­‰
   - å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯

2. **V2 å¼€å‘ä¼˜å…ˆçº§ï¼ˆå·²è°ƒæ•´ï¼‰ï¼š**
   - âœ… ~~P0 çº§åˆ«åŠŸèƒ½å·²å®Œæˆï¼ˆåˆ é™¤ã€åˆ—è¡¨ã€GCï¼‰~~
   - ğŸ”„ è¿›è¡Œä¸­ï¼šæ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•å¢å¼º
   - ğŸ“‹ è®¡åˆ’ï¼šå®Œå–„é«˜çº§åŠŸèƒ½ï¼ˆåˆ†å±‚ã€ç”Ÿå‘½å‘¨æœŸï¼‰

3. **æœªæ¥è§„åˆ’ï¼š**
   - V1 ç»§ç»­ç»´æŠ¤å’Œ bug ä¿®å¤
   - V2 è¿›å…¥æµ‹è¯•éªŒè¯é˜¶æ®µ âœ¨
   - å°è§„æ¨¡ç°åº¦æµ‹è¯•åé€æ­¥æ¨å¹¿

4. **æŠ€æœ¯å€ºåŠ¡ï¼ˆå·²å‡å°‘ï¼‰ï¼š** âœ¨
   - âœ… ~~æ ¸å¿ƒåŠŸèƒ½å·²è¡¥å…¨~~
   - âš ï¸ éœ€è¦è¡¥å……æ›´å¤šæµ‹è¯•
   - âš ï¸ éœ€è¦å®Œå–„æ–‡æ¡£
   - âš ï¸ éœ€è¦æ€§èƒ½å‹æµ‹éªŒè¯

### æœ€ç»ˆå»ºè®®

**çŸ­æœŸï¼ˆ1ä¸ªæœˆå†…ï¼‰ï¼š** âœ¨
- âœ… ~~V2 å®Œæˆæ ¸å¿ƒåŠŸèƒ½å¼€å‘~~
- ğŸ”„ V2 è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’Œæ€§èƒ½éªŒè¯
- ğŸ§ª V2 åœ¨æµ‹è¯•ç¯å¢ƒéƒ¨ç½²éªŒè¯
- ğŸ“ å®Œå–„ V2 ä½¿ç”¨æ–‡æ¡£

**ä¸­æœŸï¼ˆ3ä¸ªæœˆå†…ï¼‰ï¼š**
- ğŸ”§ V2 å®Œæˆæ€§èƒ½ä¼˜åŒ–
- ğŸ§ª V2 å°è§„æ¨¡ç°åº¦æµ‹è¯•
- ğŸ“Š æ€§èƒ½å¯¹æ¯”å’Œè¯„ä¼°
- ğŸš€ æ ¹æ®æµ‹è¯•ç»“æœå†³å®šæ¨å¹¿ç­–ç•¥

**é•¿æœŸï¼ˆ6ä¸ªæœˆå†…ï¼‰ï¼š**
- ğŸš€ V2 é€æ­¥æ›¿æ¢ V1ï¼ˆé€‚ç”¨åœºæ™¯ï¼‰
- ğŸ“ˆ æ ¹æ®å®é™…åœºæ™¯é€‰æ‹©ä½¿ç”¨
- ğŸ”„ V1 ä½œä¸ºå¤‡ä»½æ–¹æ¡ˆä¿ç•™
- ğŸŒŸ å®Œå–„ V2 é«˜çº§åŠŸèƒ½ï¼ˆåˆ†å±‚ã€ç”Ÿå‘½å‘¨æœŸï¼‰

---

## é™„å½•ï¼šå…³é”®ä»£ç ä½ç½®

### Storage V1
- ä¸»æ¨¡å—ï¼š`silent-storage-v1/src/storage.rs` (527 lines)
- é”™è¯¯å®šä¹‰ï¼š`silent-storage-v1/src/error.rs`
- å…¥å£æ–‡ä»¶ï¼š`silent-storage-v1/src/lib.rs`

### Storage V2
- å¢é‡å­˜å‚¨ï¼š`silent-storage-v2/src/storage.rs` (1000+ lines) âœ¨
- é€‚é…å™¨ï¼š`silent-storage-v2/src/adapter.rs` (281 lines)
- æ ¸å¿ƒå¼•æ“ï¼š`silent-storage-v2/src/core/engine.rs` (784 lines)
- åˆ†å—å™¨ï¼š`silent-storage-v2/src/core/chunker.rs` (328 lines)
- å‹ç¼©ï¼š`silent-storage-v2/src/core/compression.rs` (334 lines)
- å·®å¼‚è®¡ç®—ï¼š`silent-storage-v2/src/core/delta.rs` (374 lines)
- å»é‡æœåŠ¡ï¼š`silent-storage-v2/src/services/dedup.rs` (665 lines)
- ç´¢å¼•æœåŠ¡ï¼š`silent-storage-v2/src/services/index.rs` (432 lines)
- åˆ†å±‚å­˜å‚¨ï¼š`silent-storage-v2/src/services/tiering.rs` (625 lines)
- ç”Ÿå‘½å‘¨æœŸï¼š`silent-storage-v2/src/services/lifecycle.rs` (602 lines)

### V2 æ–°å¢åŠŸèƒ½ï¼ˆ2025-11-13ï¼‰âœ¨
- æ–‡ä»¶ç´¢å¼•ï¼š`FileIndexEntry` ç»“æ„
- å—å¼•ç”¨è®¡æ•°ï¼š`ChunkRefCount` ç»“æ„
- åƒåœ¾å›æ”¶ï¼š`garbage_collect()` æ–¹æ³•
- æ–‡ä»¶åˆ é™¤ï¼š`delete_file()` æ–¹æ³•
- æ–‡ä»¶åˆ—è¡¨ï¼š`list_files()` æ–¹æ³•
- æµ‹è¯•å¥—ä»¶ï¼š52ä¸ªå•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´ï¼š2025å¹´11æœˆ13æ—¥*
*åˆ†æåŸºäºåˆ†æ”¯ï¼šfeature/v0.7.0-performance-storage*
*æœ€åæ›´æ–°ï¼š2025å¹´11æœˆ13æ—¥ - V2 æ ¸å¿ƒåŠŸèƒ½å®Œå–„* âœ¨
